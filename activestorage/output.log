Edited file: /Users/richard/git/rails/activestorage/app/javascript/activestorage/multipart_blob_upload.js

yarn run v1.22.22
$ yarn lint
$ eslint app/javascript
$ rollup --config rollup.config.js
Done in 1.33s.


Generating image variants require the image_processing gem. Please add `gem 'image_processing', '~> 1.2'` to your Gemfile.
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Running 3 tests in a single process (parallelization threshold is 50)
Run options: --seed 62934

# Running:

  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
----------------------------------
UploadsTest: test_multipart_upload
----------------------------------
Capybara starting Puma...
* Version 6.6.0, codename: Return to Forever
* Min threads: 0, max threads: 4
* Listening on http://127.0.0.1:64351
Started GET "/?multipart_upload=true" for 127.0.0.1 at 2025-08-02 22:11:48 +0100
Processing by UploadsController#new as HTML
  Parameters: {"multipart_upload" => "true"}
  Rendering layout layouts/application.html.erb
  Rendering uploads/new.html.erb within layouts/application
  Rendered uploads/new.html.erb within layouts/application (Duration: 1.5ms | GC: 0.0ms)
  Rendered layout layouts/application.html.erb (Duration: 5.4ms | GC: 0.0ms)
Completed 200 OK in 76ms (Views: 7.4ms | ActiveRecord: 0.3ms (0 queries, 0 cached) | GC: 3.4ms)
Started GET "/assets/application-8b441ae0.css" for 127.0.0.1 at 2025-08-02 22:11:48 +0100
Started GET "/assets/application-f389804b.js" for 127.0.0.1 at 2025-08-02 22:11:48 +0100
Started GET "/assets/direct_uploads-3d8975eb.js" for 127.0.0.1 at 2025-08-02 22:11:48 +0100
Started GET "/assets/stimulus-loading-1fc53fe7.js" for 127.0.0.1 at 2025-08-02 22:11:48 +0100
Started GET "/assets/activestorage.esm-03d9638f.js" for 127.0.0.1 at 2025-08-02 22:11:48 +0100
Started GET "/assets/controllers/application-3affb389.js" for 127.0.0.1 at 2025-08-02 22:11:48 +0100
Started GET "/assets/controllers/hello_controller-708796bd.js" for 127.0.0.1 at 2025-08-02 22:11:48 +0100
Started GET "/assets/controllers/index-ee64e1f1.js" for 127.0.0.1 at 2025-08-02 22:11:48 +0100
Started GET "/assets/stimulus.min-4b1e420e.js" for 127.0.0.1 at 2025-08-02 22:11:49 +0100
Started GET "/assets/turbo.min-3a2e143f.js" for 127.0.0.1 at 2025-08-02 22:11:49 +0100
[JS console.debug] DirectUploadsController#startNextController
[JS console.debug] BlobRecord#create (sending to the server)
Started POST "/rails/active_storage/direct_uploads" for 127.0.0.1 at 2025-08-02 22:11:49 +0100
Processing by ActiveStorage::DirectUploadsController#create as JSON
  Parameters: {"blob" => {"filename" => "suzannes-98m.blend", "content_type" => "application/octet-stream", "byte_size" => 102744356, "checksum" => nil}, "direct_upload" => {"blob" => {"filename" => "suzannes-98m.blend", "content_type" => "application/octet-stream", "byte_size" => 102744356, "checksum" => nil}}}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mActiveStorage::Blob Create (0.3ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("byte_size", "checksum", "content_type", "created_at", "filename", "key", "metadata", "service_name") VALUES (?, ?, ?, ?, ?, ?, ?, ?) RETURNING "id"[0m  [["byte_size", 102744356], ["checksum", nil], ["content_type", "application/octet-stream"], ["created_at", "2025-08-02 21:11:49.358537"], ["filename", "suzannes-98m.blend"], ["key", "v6q4ohfebcvxmnqo7kb9wttasl5b"], ["metadata", nil], ["service_name", "localstack"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Progress: 0.0
Multipart with 4 parts of size 25686089
[36m  S3 Storage (2.6ms) [0m[34mGenerated URL for file at key: v6q4ohfebcvxmnqo7kb9wttasl5b (http://localhost:4566/rails-multipart-direct-uploads/v6q4ohfebcvxmnqo7kb9wttasl5b?partNumber=1&uploadId=gN0eoyUwhPeN9MFzbdqCT_ya3ZjFJ2HhaNvAlYWwJW-ZDJvm5V6zNAI2PMRVdPb217X5EXyNWSbv2hKg8uc4CtYpWMCfUCGfpuYvw339AhMhOP9fDau8POj2fowoa3Yl&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=test%2F20250802%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20250802T211149Z&X-Amz-Expires=300&X-Amz-SignedHeaders=host&X-Amz-Signature=9e77b5814922185a0674a0554d1be442d313adee7964ce09c0220a9117047447)[0m
[36m  S3 Storage (1.1ms) [0m[34mGenerated URL for file at key: v6q4ohfebcvxmnqo7kb9wttasl5b (http://localhost:4566/rails-multipart-direct-uploads/v6q4ohfebcvxmnqo7kb9wttasl5b?partNumber=2&uploadId=gN0eoyUwhPeN9MFzbdqCT_ya3ZjFJ2HhaNvAlYWwJW-ZDJvm5V6zNAI2PMRVdPb217X5EXyNWSbv2hKg8uc4CtYpWMCfUCGfpuYvw339AhMhOP9fDau8POj2fowoa3Yl&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=test%2F20250802%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20250802T211149Z&X-Amz-Expires=300&X-Amz-SignedHeaders=host&X-Amz-Signature=dd20752c679310f8ef50233b9550f466691244176d30cfe6795d053575eb48b4)[0m
[36m  S3 Storage (1.4ms) [0m[34mGenerated URL for file at key: v6q4ohfebcvxmnqo7kb9wttasl5b (http://localhost:4566/rails-multipart-direct-uploads/v6q4ohfebcvxmnqo7kb9wttasl5b?partNumber=3&uploadId=gN0eoyUwhPeN9MFzbdqCT_ya3ZjFJ2HhaNvAlYWwJW-ZDJvm5V6zNAI2PMRVdPb217X5EXyNWSbv2hKg8uc4CtYpWMCfUCGfpuYvw339AhMhOP9fDau8POj2fowoa3Yl&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=test%2F20250802%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20250802T211149Z&X-Amz-Expires=300&X-Amz-SignedHeaders=host&X-Amz-Signature=f7b330cee860b2113826a673156b0e93700a006f446d627e644385fdf5c200fc)[0m
[36m  S3 Storage (0.4ms) [0m[34mGenerated URL for file at key: v6q4ohfebcvxmnqo7kb9wttasl5b (http://localhost:4566/rails-multipart-direct-uploads/v6q4ohfebcvxmnqo7kb9wttasl5b?partNumber=4&uploadId=gN0eoyUwhPeN9MFzbdqCT_ya3ZjFJ2HhaNvAlYWwJW-ZDJvm5V6zNAI2PMRVdPb217X5EXyNWSbv2hKg8uc4CtYpWMCfUCGfpuYvw339AhMhOP9fDau8POj2fowoa3Yl&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=test%2F20250802%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20250802T211149Z&X-Amz-Expires=300&X-Amz-SignedHeaders=host&X-Amz-Signature=a7679663ea279aba8e80aa76f1f238740f6573e1d1bd921eb02ba266a75715af)[0m
Completed 200 OK in 33ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 2.3ms)
[JS console.debug] BlobRecord response: Object(11)
[[["id", {"type" => "number", "value" => 1}],
  ["byte_size", {"type" => "number", "value" => 102744356}],
  ["checksum", {"type" => "null"}],
  ["content_type",
   {"type" => "string", "value" => "application/octet-stream"}],
  ["created_at", {"type" => "string", "value" => "2025-08-02T21:11:49.358Z"}],
  ["filename", {"type" => "string", "value" => "suzannes-98m.blend"}],
  ["key", {"type" => "string", "value" => "v6q4ohfebcvxmnqo7kb9wttasl5b"}],
  ["metadata", {"type" => "object", "value" => []}],
  ["service_name", {"type" => "string", "value" => "localstack"}],
  ["attachable_sgid",
   {"type" => "string",
    "value" =>
     "eyJfcmFpbHMiOnsiZGF0YSI6ImdpZDovL3JhaWxzLW11bHRpcGFydC1kaXJlY3QtdXBsb2Fkcy9BY3RpdmVTdG9yYWdlOjpCbG9iLzE_ZXhwaXJlc19pbiIsInB1ciI6ImF0dGFjaGFibGUifX0=--8a7382e9090b41514e27c309fa30edf3d5733367"}],
  ["signed_id",
   {"type" => "string",
    "value" =>
     "eyJfcmFpbHMiOnsiZGF0YSI6MSwicHVyIjoiYmxvYl9pZCJ9fQ==--1ac8f89416a05d1fb99635df6ea3a97115f6a2e2"}]]]
[JS console.debug] Part 2/4 starting
[JS console.debug] Part 3/4 starting
[JS console.debug] Part 4/4 starting
[JS console.debug] Part 1/4 starting
Progress: 0.0
Progress: 0.0
[JS console.debug] update part progress
[JS console.debug] ! emit part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
Progress: 4.64
[JS console.debug] update part progress
[JS console.debug] ! emit part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] ! emit part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] ! emit part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] ! emit part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] ! emit part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] Part 1/4 uploaded
[JS console.debug] update part progress
[JS console.debug] ! emit part progress
[JS console.debug] update part progress
[JS console.debug] update part progress
[JS console.debug] Part 4/4 uploaded
[JS console.debug] update part progress
[JS console.debug] Part 2/4 uploaded
[JS console.debug] update part progress
[JS console.debug] Part 3/4 uploaded
[JS console.debug] TOTAL PROGRESS EVENTS: 7
Started PUT "/rails/active_storage/direct_uploads/1" for 127.0.0.1 at 2025-08-02 22:11:50 +0100
Processing by ActiveStorage::DirectUploadsController#update as */*
  Parameters: {"blob" => {"upload_id" => "gN0eoyUwhPeN9MFzbdqCT_ya3ZjFJ2HhaNvAlYWwJW-ZDJvm5V6zNAI2PMRVdPb217X5EXyNWSbv2hKg8uc4CtYpWMCfUCGfpuYvw339AhMhOP9fDau8POj2fowoa3Yl", "parts" => [{"etag" => "\"7060a3539a782cbc777700f632bfa786\"", "part_number" => 1}, {"etag" => "\"7f61af17e3eff20f3a1e6cc2a9d4c9f5\"", "part_number" => 2}, {"etag" => "\"de877fb36975a81519c0bc22aed44352\"", "part_number" => 3}, {"etag" => "\"557e8261066c916b7a511a4fb3bc85c2\"", "part_number" => 4}]}, "id" => "1", "direct_upload" => {"blob" => {"upload_id" => "gN0eoyUwhPeN9MFzbdqCT_ya3ZjFJ2HhaNvAlYWwJW-ZDJvm5V6zNAI2PMRVdPb217X5EXyNWSbv2hKg8uc4CtYpWMCfUCGfpuYvw339AhMhOP9fDau8POj2fowoa3Yl", "parts" => [{"etag" => "\"7060a3539a782cbc777700f632bfa786\"", "part_number" => 1}, {"etag" => "\"7f61af17e3eff20f3a1e6cc2a9d4c9f5\"", "part_number" => 2}, {"etag" => "\"de877fb36975a81519c0bc22aed44352\"", "part_number" => 3}, {"etag" => "\"557e8261066c916b7a511a4fb3bc85c2\"", "part_number" => 4}]}}}
  [1m[36mActiveStorage::Blob Load (0.2ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[JS console.debug] All parts uploaded, completing multipart upload
Completed 200 OK in 66ms (ActiveRecord: 0.1ms (1 query, 0 cached) | GC: 0.0ms)
Started POST "/uploads" for 127.0.0.1 at 2025-08-02 22:11:50 +0100
Processing by UploadsController#create as TURBO_STREAM
  Parameters: {"upload" => {"files" => ["", "eyJfcmFpbHMiOnsiZGF0YSI6MSwicHVyIjoiYmxvYl9pZCJ9fQ==--1ac8f89416a05d1fb99635df6ea3a97115f6a2e2"]}, "commit" => "Create Upload"}
  [1m[36mActiveStorage::Blob Load (0.1ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUpload Create (0.3ms)[0m  [1m[32mINSERT INTO "uploads" ("created_at", "updated_at") VALUES (?, ?) RETURNING "id"[0m  [["created_at", "2025-08-02 21:11:50.205725"], ["updated_at", "2025-08-02 21:11:50.205725"]]
  [1m[36mActiveStorage::Blob Update (0.0ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = ? WHERE "active_storage_blobs"."id" = ?[0m  [["metadata", "{\"identified\":true}"], ["id", 1]]
  [1m[36mActiveStorage::Attachment Load (0.5ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = ?[0m  [["blob_id", 1]]
  [1m[36mActiveStorage::Attachment Create (0.1ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("blob_id", "created_at", "name", "record_id", "record_type") VALUES (?, ?, ?, ?, ?) RETURNING "id"[0m  [["blob_id", 1], ["created_at", "2025-08-02 21:11:50.210799"], ["name", "files"], ["record_id", 1], ["record_type", "Upload"]]
  [1m[36mUpload Update (0.0ms)[0m  [1m[33mUPDATE "uploads" SET "updated_at" = ? WHERE "uploads"."id" = ?[0m  [["updated_at", "2025-08-02 21:11:50.212314"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mActiveStorage::Blob Update (0.1ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = ? WHERE "active_storage_blobs"."id" = ?[0m  [["metadata", "{\"identified\":true,\"analyzed\":true}"], ["id", 1]]
  [1m[36mActiveStorage::Attachment Load (0.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = ?[0m  [["blob_id", 1]]
  [1m[36mUpload Load (0.0ms)[0m  [1m[34mSELECT "uploads".* FROM "uploads" WHERE "uploads"."id" = ?[0m  [["id", 1]]
  [1m[36mUpload Update (0.0ms)[0m  [1m[33mUPDATE "uploads" SET "updated_at" = ? WHERE "uploads"."id" = ?[0m  [["updated_at", "2025-08-02 21:11:50.217995"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://127.0.0.1:64351/uploads
Completed 302 Found in 30ms (ActiveRecord: 1.4ms (10 queries, 0 cached) | GC: 0.0ms)
Started GET "/uploads" for 127.0.0.1 at 2025-08-02 22:11:50 +0100
Processing by UploadsController#index as TURBO_STREAM
  Rendering layout layouts/application.html.erb
  Rendering uploads/index.html.erb within layouts/application
  [1m[36mUpload Load (0.0ms)[0m  [1m[34mSELECT "uploads".* FROM "uploads"[0m
  [1m[36mActiveStorage::Attachment Load (0.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = ? AND "active_storage_attachments"."record_type" = ? AND "active_storage_attachments"."name" = ?[0m  [["record_id", 1], ["record_type", "Upload"], ["name", "files"]]
  [1m[36mActiveStorage::Blob Load (0.0ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  Rendered collection of uploads/_upload.html.erb [1 times] (Duration: 7.7ms | GC: 0.0ms)
  Rendered uploads/index.html.erb within layouts/application (Duration: 8.5ms | GC: 0.0ms)
  Rendered layout layouts/application.html.erb (Duration: 8.7ms | GC: 0.0ms)
Completed 200 OK in 10ms (Views: 8.8ms | ActiveRecord: 0.1ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUpload Load (0.1ms)[0m  [1m[34mSELECT "uploads".* FROM "uploads" ORDER BY "uploads"."id" DESC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mActiveStorage::Attachment Load (0.2ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = ? AND "active_storage_attachments"."record_type" = ? AND "active_storage_attachments"."name" = ? ORDER BY "active_storage_attachments"."id" ASC LIMIT ?[0m  [["record_id", 1], ["record_type", "Upload"], ["name", "files"], ["LIMIT", 1]]
  [1m[36mActiveStorage::Blob Load (0.0ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
[36m  S3 Storage (19.6ms) [0m[31mDeleted files by key prefix: [0m
.  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
------------------------------------
UploadsTest: test_single_part_upload
------------------------------------
Started GET "/" for 127.0.0.1 at 2025-08-02 22:11:50 +0100
Processing by UploadsController#new as HTML
  Rendering layout layouts/application.html.erb
  Rendering uploads/new.html.erb within layouts/application
  Rendered uploads/new.html.erb within layouts/application (Duration: 2.1ms | GC: 0.0ms)
  Rendered layout layouts/application.html.erb (Duration: 2.9ms | GC: 0.0ms)
Completed 200 OK in 4ms (Views: 3.1ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
[JS console.debug] DirectUploadsController#startNextController
Progress: 0.0
Progress: 0.0
Progress: 0.0
Progress: 0.0
Progress: 0.0
Progress: 0.0
Progress: 0.0
Progress: 0.0
Progress: 0.0
Progress: 0.0
Progress: 0.0
[JS console.debug] Calculated checksum in 1.0s
[JS console.debug] BlobRecord#create (sending to the server)
Started POST "/rails/active_storage/direct_uploads" for 127.0.0.1 at 2025-08-02 22:11:51 +0100
Processing by ActiveStorage::DirectUploadsController#create as JSON
  Parameters: {"blob" => {"filename" => "suzannes-98m.blend", "content_type" => "application/octet-stream", "byte_size" => 102744356, "checksum" => "3rg6k6gRM1xzb2/F0RhX4w=="}, "direct_upload" => {"blob" => {"filename" => "suzannes-98m.blend", "content_type" => "application/octet-stream", "byte_size" => 102744356, "checksum" => "3rg6k6gRM1xzb2/F0RhX4w=="}}}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mActiveStorage::Blob Create (0.2ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("byte_size", "checksum", "content_type", "created_at", "filename", "key", "metadata", "service_name") VALUES (?, ?, ?, ?, ?, ?, ?, ?) RETURNING "id"[0m  [["byte_size", 102744356], ["checksum", "3rg6k6gRM1xzb2/F0RhX4w=="], ["content_type", "application/octet-stream"], ["created_at", "2025-08-02 21:11:51.849025"], ["filename", "suzannes-98m.blend"], ["key", "f7ham0xg92bkafo50yalzfvk7wqq"], ["metadata", nil], ["service_name", "localstack"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[36m  S3 Storage (3.0ms) [0m[34mGenerated URL for file at key: f7ham0xg92bkafo50yalzfvk7wqq (http://localhost:4566/rails-multipart-direct-uploads/f7ham0xg92bkafo50yalzfvk7wqq?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=test%2F20250802%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20250802T211151Z&X-Amz-Expires=300&X-Amz-SignedHeaders=content-length%3Bcontent-md5%3Bcontent-type%3Bhost&X-Amz-Signature=5febce54a2c0a1f8145adc5c5ecabdcf292854d091d62a09e62f60330bd2df4e)[0m
Completed 200 OK in 17ms (Views: 0.1ms | ActiveRecord: 0.9ms (1 query, 0 cached) | GC: 3.7ms)
Progress: 0.0
[JS console.debug] BlobRecord response: Object(11)
[[["id", {"type" => "number", "value" => 1}],
  ["byte_size", {"type" => "number", "value" => 102744356}],
  ["checksum", {"type" => "string", "value" => "3rg6k6gRM1xzb2/F0RhX4w=="}],
  ["content_type",
   {"type" => "string", "value" => "application/octet-stream"}],
  ["created_at", {"type" => "string", "value" => "2025-08-02T21:11:51.849Z"}],
  ["filename", {"type" => "string", "value" => "suzannes-98m.blend"}],
  ["key", {"type" => "string", "value" => "f7ham0xg92bkafo50yalzfvk7wqq"}],
  ["metadata", {"type" => "object", "value" => []}],
  ["service_name", {"type" => "string", "value" => "localstack"}],
  ["attachable_sgid",
   {"type" => "string",
    "value" =>
     "eyJfcmFpbHMiOnsiZGF0YSI6ImdpZDovL3JhaWxzLW11bHRpcGFydC1kaXJlY3QtdXBsb2Fkcy9BY3RpdmVTdG9yYWdlOjpCbG9iLzE_ZXhwaXJlc19pbiIsInB1ciI6ImF0dGFjaGFibGUifX0=--8a7382e9090b41514e27c309fa30edf3d5733367"}],
  ["signed_id",
   {"type" => "string",
    "value" =>
     "eyJfcmFpbHMiOnsiZGF0YSI6MSwicHVyIjoiYmxvYl9pZCJ9fQ==--1ac8f89416a05d1fb99635df6ea3a97115f6a2e2"}]]]
[JS console.debug] BlobUpload#create (uploading to S3)
Progress: 0.0
Progress: 12.43
Started POST "/uploads" for 127.0.0.1 at 2025-08-02 22:11:52 +0100
Processing by UploadsController#create as TURBO_STREAM
  Parameters: {"upload" => {"files" => ["", "eyJfcmFpbHMiOnsiZGF0YSI6MSwicHVyIjoiYmxvYl9pZCJ9fQ==--1ac8f89416a05d1fb99635df6ea3a97115f6a2e2"]}, "commit" => "Create Upload"}
  [1m[36mActiveStorage::Blob Load (0.1ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUpload Create (1.0ms)[0m  [1m[32mINSERT INTO "uploads" ("created_at", "updated_at") VALUES (?, ?) RETURNING "id"[0m  [["created_at", "2025-08-02 21:11:52.872695"], ["updated_at", "2025-08-02 21:11:52.872695"]]
  [1m[36mActiveStorage::Blob Update (0.0ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = ? WHERE "active_storage_blobs"."id" = ?[0m  [["metadata", "{\"identified\":true}"], ["id", 1]]
  [1m[36mActiveStorage::Attachment Load (0.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = ?[0m  [["blob_id", 1]]
  [1m[36mActiveStorage::Attachment Create (0.1ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("blob_id", "created_at", "name", "record_id", "record_type") VALUES (?, ?, ?, ?, ?) RETURNING "id"[0m  [["blob_id", 1], ["created_at", "2025-08-02 21:11:52.886805"], ["name", "files"], ["record_id", 1], ["record_type", "Upload"]]
  [1m[36mUpload Update (0.2ms)[0m  [1m[33mUPDATE "uploads" SET "updated_at" = ? WHERE "uploads"."id" = ?[0m  [["updated_at", "2025-08-02 21:11:52.889557"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mActiveStorage::Blob Update (0.1ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = ? WHERE "active_storage_blobs"."id" = ?[0m  [["metadata", "{\"identified\":true,\"analyzed\":true}"], ["id", 1]]
  [1m[36mActiveStorage::Attachment Load (0.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = ?[0m  [["blob_id", 1]]
  [1m[36mUpload Load (0.0ms)[0m  [1m[34mSELECT "uploads".* FROM "uploads" WHERE "uploads"."id" = ?[0m  [["id", 1]]
  [1m[36mUpload Update (0.0ms)[0m  [1m[33mUPDATE "uploads" SET "updated_at" = ? WHERE "uploads"."id" = ?[0m  [["updated_at", "2025-08-02 21:11:52.898637"], ["id", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://127.0.0.1:64351/uploads
Completed 302 Found in 36ms (ActiveRecord: 2.2ms (10 queries, 0 cached) | GC: 0.4ms)
Started GET "/uploads" for 127.0.0.1 at 2025-08-02 22:11:52 +0100
Processing by UploadsController#index as TURBO_STREAM
  Rendering layout layouts/application.html.erb
  Rendering uploads/index.html.erb within layouts/application
  [1m[36mUpload Load (0.0ms)[0m  [1m[34mSELECT "uploads".* FROM "uploads"[0m
  [1m[36mActiveStorage::Attachment Load (0.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = ? AND "active_storage_attachments"."record_type" = ? AND "active_storage_attachments"."name" = ?[0m  [["record_id", 1], ["record_type", "Upload"], ["name", "files"]]
  [1m[36mActiveStorage::Blob Load (0.1ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  Rendered collection of uploads/_upload.html.erb [1 times] (Duration: 13.5ms | GC: 0.0ms)
  Rendered uploads/index.html.erb within layouts/application (Duration: 15.5ms | GC: 0.0ms)
  Rendered layout layouts/application.html.erb (Duration: 16.1ms | GC: 0.0ms)
Completed 200 OK in 17ms (Views: 16.8ms | ActiveRecord: 0.1ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUpload Load (0.3ms)[0m  [1m[34mSELECT "uploads".* FROM "uploads" ORDER BY "uploads"."id" DESC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mActiveStorage::Attachment Load (0.1ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = ? AND "active_storage_attachments"."record_type" = ? AND "active_storage_attachments"."name" = ? ORDER BY "active_storage_attachments"."id" ASC LIMIT ?[0m  [["record_id", 1], ["record_type", "Upload"], ["name", "files"], ["LIMIT", 1]]
  [1m[36mActiveStorage::Blob Load (0.0ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
[36m  S3 Storage (21.9ms) [0m[31mDeleted files by key prefix: [0m
.  [1m[36mTRANSACTION (0.0ms)[0m  [1m[36mBEGIN deferred TRANSACTION[0m
---------------------------------------------------
UploadsTest: test_smaller_than_5MB_multipart_upload
---------------------------------------------------
Started GET "/?multipart_upload=true" for 127.0.0.1 at 2025-08-02 22:11:53 +0100
Processing by UploadsController#new as HTML
  Parameters: {"multipart_upload" => "true"}
  Rendering layout layouts/application.html.erb
  Rendering uploads/new.html.erb within layouts/application
  Rendered uploads/new.html.erb within layouts/application (Duration: 0.9ms | GC: 0.0ms)
  Rendered layout layouts/application.html.erb (Duration: 1.8ms | GC: 0.0ms)
Completed 200 OK in 4ms (Views: 2.3ms | ActiveRecord: 0.0ms (0 queries, 0 cached) | GC: 0.0ms)
[JS console.debug] DirectUploadsController#startNextController
Started POST "/rails/active_storage/direct_uploads" for 127.0.0.1 at 2025-08-02 22:11:53 +0100
Processing by ActiveStorage::DirectUploadsController#create as JSON
  Parameters: {"blob" => {"filename" => "suzanne-1.2m.blend", "content_type" => "application/octet-stream", "byte_size" => 1310538, "checksum" => nil}, "direct_upload" => {"blob" => {"filename" => "suzanne-1.2m.blend", "content_type" => "application/octet-stream", "byte_size" => 1310538, "checksum" => nil}}}
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mActiveStorage::Blob Create (0.3ms)[0m  [1m[32mINSERT INTO "active_storage_blobs" ("byte_size", "checksum", "content_type", "created_at", "filename", "key", "metadata", "service_name") VALUES (?, ?, ?, ?, ?, ?, ?, ?) RETURNING "id"[0m  [["byte_size", 1310538], ["checksum", nil], ["content_type", "application/octet-stream"], ["created_at", "2025-08-02 21:11:53.517250"], ["filename", "suzanne-1.2m.blend"], ["key", "snbn4vkc5hrrnn7a8dk2qnjnzwpp"], ["metadata", nil], ["service_name", "localstack"]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
[JS console.debug] BlobRecord#create (sending to the server)
Multipart with 1 parts of size 1310538
[36m  S3 Storage (1.3ms) [0m[34mGenerated URL for file at key: snbn4vkc5hrrnn7a8dk2qnjnzwpp (http://localhost:4566/rails-multipart-direct-uploads/snbn4vkc5hrrnn7a8dk2qnjnzwpp?partNumber=1&uploadId=X8Pv_ZUJVXeKJxnVETA1tFzkidWUu4wmzdkREgJlFjNf3ii2-zSLfOrpmqEKRs9v1XabxcZ--rwiyUc8bAcNhppALCWG78jnstvQe9FHp_3ca8_TWjl6oIpmYOHgZ4O1&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=test%2F20250802%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20250802T211153Z&X-Amz-Expires=300&X-Amz-SignedHeaders=host&X-Amz-Signature=3152c2a16c25355b38297ab4445892252f58afe4b973487c6e1cf6cfdc67ebe8)[0m
Completed 200 OK in 11ms (Views: 0.1ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.1ms)
[JS console.debug] BlobRecord response: Object(11)
[[["id", {"type" => "number", "value" => 1}],
  ["byte_size", {"type" => "number", "value" => 1310538}],
  ["checksum", {"type" => "null"}],
  ["content_type",
   {"type" => "string", "value" => "application/octet-stream"}],
  ["created_at", {"type" => "string", "value" => "2025-08-02T21:11:53.517Z"}],
  ["filename", {"type" => "string", "value" => "suzanne-1.2m.blend"}],
  ["key", {"type" => "string", "value" => "snbn4vkc5hrrnn7a8dk2qnjnzwpp"}],
  ["metadata", {"type" => "object", "value" => []}],
  ["service_name", {"type" => "string", "value" => "localstack"}],
  ["attachable_sgid",
   {"type" => "string",
    "value" =>
     "eyJfcmFpbHMiOnsiZGF0YSI6ImdpZDovL3JhaWxzLW11bHRpcGFydC1kaXJlY3QtdXBsb2Fkcy9BY3RpdmVTdG9yYWdlOjpCbG9iLzE_ZXhwaXJlc19pbiIsInB1ciI6ImF0dGFjaGFibGUifX0=--8a7382e9090b41514e27c309fa30edf3d5733367"}],
  ["signed_id",
   {"type" => "string",
    "value" =>
     "eyJfcmFpbHMiOnsiZGF0YSI6MSwicHVyIjoiYmxvYl9pZCJ9fQ==--1ac8f89416a05d1fb99635df6ea3a97115f6a2e2"}]]]
[JS console.debug] Part 1/1 starting
[JS console.debug] update part progress
Started PUT "/rails/active_storage/direct_uploads/1" for 127.0.0.1 at 2025-08-02 22:11:53 +0100
Processing by ActiveStorage::DirectUploadsController#update as */*
  Parameters: {"blob" => {"upload_id" => "X8Pv_ZUJVXeKJxnVETA1tFzkidWUu4wmzdkREgJlFjNf3ii2-zSLfOrpmqEKRs9v1XabxcZ--rwiyUc8bAcNhppALCWG78jnstvQe9FHp_3ca8_TWjl6oIpmYOHgZ4O1", "parts" => [{"etag" => "\"c21ac89bf079783803ade9c697671fc4\"", "part_number" => 1}]}, "id" => "1", "direct_upload" => {"blob" => {"upload_id" => "X8Pv_ZUJVXeKJxnVETA1tFzkidWUu4wmzdkREgJlFjNf3ii2-zSLfOrpmqEKRs9v1XabxcZ--rwiyUc8bAcNhppALCWG78jnstvQe9FHp_3ca8_TWjl6oIpmYOHgZ4O1", "parts" => [{"etag" => "\"c21ac89bf079783803ade9c697671fc4\"", "part_number" => 1}]}}}
  [1m[36mActiveStorage::Blob Load (0.2ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
[JS console.debug] All parts uploaded, completing multipart upload
[JS console.debug] TOTAL PROGRESS EVENTS: 1
[JS console.debug] ! emit part progress
[JS console.debug] update part progress
[JS console.debug] Part 1/1 uploaded
Completed 200 OK in 6ms (ActiveRecord: 0.1ms (1 query, 0 cached) | GC: 0.0ms)
Started POST "/uploads" for 127.0.0.1 at 2025-08-02 22:11:53 +0100
Processing by UploadsController#create as TURBO_STREAM
  Parameters: {"upload" => {"files" => ["", "eyJfcmFpbHMiOnsiZGF0YSI6MSwicHVyIjoiYmxvYl9pZCJ9fQ==--1ac8f89416a05d1fb99635df6ea3a97115f6a2e2"]}, "commit" => "Create Upload"}
  [1m[36mActiveStorage::Blob Load (0.1ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUpload Create (0.4ms)[0m  [1m[32mINSERT INTO "uploads" ("created_at", "updated_at") VALUES (?, ?) RETURNING "id"[0m  [["created_at", "2025-08-02 21:11:53.567730"], ["updated_at", "2025-08-02 21:11:53.567730"]]
  [1m[36mActiveStorage::Blob Update (0.0ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = ? WHERE "active_storage_blobs"."id" = ?[0m  [["metadata", "{\"identified\":true}"], ["id", 1]]
  [1m[36mActiveStorage::Attachment Load (0.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = ?[0m  [["blob_id", 1]]
  [1m[36mActiveStorage::Attachment Create (0.2ms)[0m  [1m[32mINSERT INTO "active_storage_attachments" ("blob_id", "created_at", "name", "record_id", "record_type") VALUES (?, ?, ?, ?, ?) RETURNING "id"[0m  [["blob_id", 1], ["created_at", "2025-08-02 21:11:53.572910"], ["name", "files"], ["record_id", 1], ["record_type", "Upload"]]
  [1m[36mUpload Update (0.1ms)[0m  [1m[33mUPDATE "uploads" SET "updated_at" = ? WHERE "uploads"."id" = ?[0m  [["updated_at", "2025-08-02 21:11:53.573313"], ["id", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mActiveStorage::Blob Update (0.2ms)[0m  [1m[33mUPDATE "active_storage_blobs" SET "metadata" = ? WHERE "active_storage_blobs"."id" = ?[0m  [["metadata", "{\"identified\":true,\"analyzed\":true}"], ["id", 1]]
  [1m[36mActiveStorage::Attachment Load (0.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."blob_id" = ?[0m  [["blob_id", 1]]
  [1m[36mUpload Load (0.0ms)[0m  [1m[34mSELECT "uploads".* FROM "uploads" WHERE "uploads"."id" = ?[0m  [["id", 1]]
  [1m[36mUpload Update (0.0ms)[0m  [1m[33mUPDATE "uploads" SET "updated_at" = ? WHERE "uploads"."id" = ?[0m  [["updated_at", "2025-08-02 21:11:53.578648"], ["id", 1]]
  [1m[36mTRANSACTION (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://127.0.0.1:64351/uploads
Completed 302 Found in 20ms (ActiveRecord: 1.0ms (10 queries, 0 cached) | GC: 0.0ms)
Started GET "/uploads" for 127.0.0.1 at 2025-08-02 22:11:53 +0100
Processing by UploadsController#index as TURBO_STREAM
  Rendering layout layouts/application.html.erb
  Rendering uploads/index.html.erb within layouts/application
  [1m[36mUpload Load (0.0ms)[0m  [1m[34mSELECT "uploads".* FROM "uploads"[0m
  [1m[36mActiveStorage::Attachment Load (0.0ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = ? AND "active_storage_attachments"."record_type" = ? AND "active_storage_attachments"."name" = ?[0m  [["record_id", 1], ["record_type", "Upload"], ["name", "files"]]
  [1m[36mActiveStorage::Blob Load (0.0ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  Rendered collection of uploads/_upload.html.erb [1 times] (Duration: 2.7ms | GC: 0.0ms)
  Rendered uploads/index.html.erb within layouts/application (Duration: 2.9ms | GC: 0.0ms)
  Rendered layout layouts/application.html.erb (Duration: 3.2ms | GC: 0.0ms)
Completed 200 OK in 4ms (Views: 3.4ms | ActiveRecord: 0.1ms (3 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUpload Load (0.1ms)[0m  [1m[34mSELECT "uploads".* FROM "uploads" ORDER BY "uploads"."id" DESC LIMIT ?[0m  [["LIMIT", 1]]
  [1m[36mActiveStorage::Attachment Load (0.2ms)[0m  [1m[34mSELECT "active_storage_attachments".* FROM "active_storage_attachments" WHERE "active_storage_attachments"."record_id" = ? AND "active_storage_attachments"."record_type" = ? AND "active_storage_attachments"."name" = ? ORDER BY "active_storage_attachments"."id" ASC LIMIT ?[0m  [["record_id", 1], ["record_type", "Upload"], ["name", "files"], ["LIMIT", 1]]
  [1m[36mActiveStorage::Blob Load (0.0ms)[0m  [1m[34mSELECT "active_storage_blobs".* FROM "active_storage_blobs" WHERE "active_storage_blobs"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TRANSACTION[0m
[36m  S3 Storage (8.7ms) [0m[31mDeleted files by key prefix: [0m
.

Finished in 6.029330s, 0.4976 runs/s, 1.8244 assertions/s.
3 runs, 11 assertions, 0 failures, 0 errors, 0 skips


